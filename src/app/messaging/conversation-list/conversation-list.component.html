<div class="vmo-component">
  <vmo-toolbar title="Messages" mode="menu">
    <button md-icon-button routerLink="new">
      <md-icon>add</md-icon>
    </button>
  </vmo-toolbar>

  <vmo-progress-spinner [hasLoaded]="isLoading">
    <md-list class="vmo-list" *ngIf="conversations?.length">
      <md-list-item md-ripple
                    *ngFor="let conversation of conversations | filteredConversations"
                    [routerLink]="conversation.id"
                    class="u-clickable">

        <img md-list-avatar src="http://lorempixel.com/40/40">

        <span md-line class="mdc-typography--subheading1" [class.u-highlight]="hasUnread(conversation)">
          {{ conversation.participations | filteredParticipations:currentUser | conversationTitle }}
        </span>

        <span md-line
              class="mdc-typography--body1 u-weak"
              [class.u-highlight]="hasUnread(conversation)">
          <span *ngIf="conversation.lastMessage.userId === currentUser.id">You: </span>
          {{ conversation.lastMessage?.body }}
        </span>

        <span class="u-fill"></span>

        <span class="mdc-typography--caption u-weak u-nowrap"
              [class.u-highlight]="hasUnread(conversation)">
          {{ (conversation.lastMessage ? conversation.lastMessage.sentAt : conversation.startedAt) | amTimeAgo }}
        </span>

      </md-list-item>
    </md-list>

    <div *ngIf="! conversationListService.isComplete()" fxLayoutAlign="center">
      <button md-raised-button (click)="conversationListService.paginate()">
        Load more
      </button>
    </div>
  </vmo-progress-spinner>
</div>

<router-outlet></router-outlet>