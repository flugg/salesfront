<div class = "component-wrapper">
    <sf-toolbar mode="menu" title="Messages">
        <button md-icon-button [routerLink] = "'new'">
            <md-icon>add</md-icon>
        </button>
    </sf-toolbar>

    <div [fxShow]="isLoading">
        <md-progress-circle mode="indeterminate" color="accent"></md-progress-circle>
    </div>

    <div [fxHide]="isLoading">
        <md-card class = "stripped-card">
            <md-list class = 'card-list'>
                <md-list-item mat-ripple
                              mdRippleSpeedFactor="6"
                              *ngFor="let conversation of conversations | async | ignoreEmpty"
                              [routerLink]="[conversation.id]"
                              [ngClass]="{'new-message': hasUnread(conversation)}"
                              class="message">
                    <img md-list-avatar src="http://lorempixel.com/40/40">
                    <h4 md-line class="mdc-typography--body2">
                        <span *ngFor = "let participation of conversation.participations | participating:currentUser"
                              class = "comma-separated">{{ participation.user.name }}</span>
                    </h4>
                    <span md-line class="mdc-typography--body1" [ngClass]="{'text-weak': ! hasUnread(conversation)}">{{ conversation.lastMessage?.body }}</span>
                    <span class = "fill-space"></span>
                    <span class="timestamp" [ngClass]="{'text-weak': ! hasUnread(conversation)}">{{ (conversation.lastMessage ? conversation.lastMessage.sentAt : conversation.startedAt) | amTimeAgo }}</span>
                </md-list-item>
            </md-list>
        </md-card>
        <md-list>
            <md-list-item *ngIf = "! hasLoadedAll()" fxLayoutAlign = "center">
                <button md-raised-button (click) = "loadMore()">Load More</button>
            </md-list-item>
        </md-list>
    </div>
</div>

<router-outlet></router-outlet>